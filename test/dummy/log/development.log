  [1m[36m (1.5ms)[0m  [1mCREATE VIEW hello_world AS SELECT 'HelloWorld'[0m
  [1m[36m (0.2ms)[0m  [1mCREATE VIEW hello_world AS SELECT 'HelloWorld'[0m
SQLite3::SQLException: table hello_world already exists: CREATE VIEW hello_world AS SELECT 'HelloWorld'
  [1m[36m (0.3ms)[0m  [1mCREATE VIEW hello_world AS SELECT 'HelloWorld'[0m
SQLite3::SQLException: table hello_world already exists: CREATE VIEW hello_world AS SELECT 'HelloWorld'
  [1m[36m (1.6ms)[0m  [1mDROP VIEW hello_world[0m
  [1m[35m (0.1ms)[0m  DROP VIEW required
SQLite3::SQLException: no such view: required: DROP VIEW required
  [1m[36m (0.9ms)[0m  [1mCREATE TABLE "schema_migrations" ("version" varchar(255) NOT NULL) [0m
  [1m[35m (0.8ms)[0m  CREATE UNIQUE INDEX "unique_schema_migrations" ON "schema_migrations" ("version")
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (1.0ms)[0m  CREATE VIEW hello_world AS SELECT 'HelloWorld'
  [1m[36m (0.8ms)[0m  [1mCREATE VIEW required AS SELECT 1[0m
  [1m[36m (2.0ms)[0m  [1mDROP VIEW hello_world[0m
  [1m[35m (1.0ms)[0m  DROP VIEW required
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  CREATE VIEW hello_world AS SELECT 'HelloWorld' WHERE ( SELECT * AS required ) = 1
SQLite3::SQLException: near "AS": syntax error: CREATE VIEW hello_world AS SELECT 'HelloWorld' WHERE ( SELECT * AS required ) = 1
  [1m[36m (0.3ms)[0m  [1mDROP VIEW hello_world[0m
SQLite3::SQLException: no such view: hello_world: DROP VIEW hello_world
  [1m[35m (0.1ms)[0m  DROP VIEW required
SQLite3::SQLException: no such view: required: DROP VIEW required
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  CREATE VIEW hello_world AS SELECT 'HelloWorld' WHERE ( SELECT id AS required ) IN (1)
SQLite3::SQLException: no such column: id: CREATE VIEW hello_world AS SELECT 'HelloWorld' WHERE ( SELECT id AS required ) IN (1)
  [1m[36m (0.3ms)[0m  [1mDROP VIEW hello_world[0m
SQLite3::SQLException: no such view: hello_world: DROP VIEW hello_world
  [1m[35m (0.1ms)[0m  DROP VIEW required
SQLite3::SQLException: no such view: required: DROP VIEW required
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  CREATE VIEW hello_world AS SELECT 'HelloWorld' WHERE ( SELECT id FROM required ) IN (1)
SQLite3::SQLException: no such table: main.required: CREATE VIEW hello_world AS SELECT 'HelloWorld' WHERE ( SELECT id FROM required ) IN (1)
  [1m[36m (0.4ms)[0m  [1mDROP VIEW hello_world[0m
SQLite3::SQLException: no such view: hello_world: DROP VIEW hello_world
  [1m[35m (0.1ms)[0m  DROP VIEW required
SQLite3::SQLException: no such view: required: DROP VIEW required
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.2ms)[0m  CREATE VIEW hello_world AS SELECT 'HelloWorld' WHERE ( SELECT id FROM required ) IN (1)
SQLite3::SQLException: no such table: main.required: CREATE VIEW hello_world AS SELECT 'HelloWorld' WHERE ( SELECT id FROM required ) IN (1)
  [1m[36m (0.3ms)[0m  [1mDROP VIEW hello_world[0m
SQLite3::SQLException: no such view: hello_world: DROP VIEW hello_world
  [1m[35m (0.1ms)[0m  DROP VIEW required
SQLite3::SQLException: no such view: required: DROP VIEW required
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  CREATE VIEW hello_world AS SELECT 'HelloWorld' WHERE ( SELECT id FROM required ) IN (1)
SQLite3::SQLException: no such table: main.required: CREATE VIEW hello_world AS SELECT 'HelloWorld' WHERE ( SELECT id FROM required ) IN (1)
  [1m[36m (0.3ms)[0m  [1mDROP VIEW hello_world[0m
SQLite3::SQLException: no such view: hello_world: DROP VIEW hello_world
  [1m[35m (0.1ms)[0m  DROP VIEW required
SQLite3::SQLException: no such view: required: DROP VIEW required
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.2ms)[0m  CREATE VIEW hello_world AS SELECT 'HelloWorld' WHERE ( SELECT id FROM required ) IN (1)
SQLite3::SQLException: no such table: main.required: CREATE VIEW hello_world AS SELECT 'HelloWorld' WHERE ( SELECT id FROM required ) IN (1)
  [1m[36m (0.3ms)[0m  [1mDROP VIEW hello_world[0m
SQLite3::SQLException: no such view: hello_world: DROP VIEW hello_world
  [1m[35m (0.1ms)[0m  DROP VIEW required
SQLite3::SQLException: no such view: required: DROP VIEW required
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (1.3ms)[0m  CREATE VIEW hello_world AS SELECT 1 as id
  [1m[36m (0.1ms)[0m  [1mCREATE VIEW hello_world AS SELECT 'HelloWorld' WHERE ( SELECT id FROM required ) IN (1)[0m
SQLite3::SQLException: table hello_world already exists: CREATE VIEW hello_world AS SELECT 'HelloWorld' WHERE ( SELECT id FROM required ) IN (1)
  [1m[36m (1.9ms)[0m  [1mDROP VIEW hello_world[0m
  [1m[35m (0.2ms)[0m  DROP VIEW required
SQLite3::SQLException: no such view: required: DROP VIEW required
  [1m[36m (0.5ms)[0m  [1mDROP VIEW hello_world[0m
SQLite3::SQLException: no such view: hello_world: DROP VIEW hello_world
  [1m[35m (0.1ms)[0m  DROP VIEW required
SQLite3::SQLException: no such view: required: DROP VIEW required
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.9ms)[0m  CREATE VIEW hello_world AS SELECT 1 as id
  [1m[36m (0.1ms)[0m  [1mCREATE VIEW hello_world AS SELECT 'HelloWorld' WHERE ( SELECT id FROM required ) IN (1)[0m
SQLite3::SQLException: table hello_world already exists: CREATE VIEW hello_world AS SELECT 'HelloWorld' WHERE ( SELECT id FROM required ) IN (1)
  [1m[36m (1.6ms)[0m  [1mDROP VIEW hello_world[0m
  [1m[35m (0.1ms)[0m  DROP VIEW required
SQLite3::SQLException: no such view: required: DROP VIEW required
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (1.0ms)[0m  CREATE VIEW hello_world AS SELECT 1 as id
  [1m[36m (0.1ms)[0m  [1mCREATE VIEW hello_world AS SELECT 'HelloWorld' WHERE ( SELECT id FROM required ) IN (1)[0m
SQLite3::SQLException: table hello_world already exists: CREATE VIEW hello_world AS SELECT 'HelloWorld' WHERE ( SELECT id FROM required ) IN (1)
  [1m[36m (2.1ms)[0m  [1mDROP VIEW hello_world[0m
  [1m[35m (0.2ms)[0m  DROP VIEW required
SQLite3::SQLException: no such view: required: DROP VIEW required
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (1.0ms)[0m  CREATE VIEW hello_world AS SELECT 1 as id
  [1m[36m (0.1ms)[0m  [1mCREATE VIEW hello_world AS SELECT 'HelloWorld' WHERE ( SELECT id FROM required ) IN (1)[0m
SQLite3::SQLException: table hello_world already exists: CREATE VIEW hello_world AS SELECT 'HelloWorld' WHERE ( SELECT id FROM required ) IN (1)
  [1m[36m (1.2ms)[0m  [1mDROP VIEW hello_world[0m
  [1m[35m (0.1ms)[0m  DROP VIEW required
SQLite3::SQLException: no such view: required: DROP VIEW required
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[36m (0.3ms)[0m  [1mDROP VIEW hello_world[0m
SQLite3::SQLException: no such view: hello_world: DROP VIEW hello_world
  [1m[35m (0.1ms)[0m  DROP VIEW required
SQLite3::SQLException: no such view: required: DROP VIEW required
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[36m (0.3ms)[0m  [1mDROP VIEW hello_world[0m
SQLite3::SQLException: no such view: hello_world: DROP VIEW hello_world
  [1m[35m (0.1ms)[0m  DROP VIEW required
SQLite3::SQLException: no such view: required: DROP VIEW required
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  SELECT 1 as id
  [1m[36m (0.1ms)[0m  [1mSELECT 'HelloWorld' WHERE ( SELECT id FROM required ) IN (1)[0m
SQLite3::SQLException: no such table: required: SELECT 'HelloWorld' WHERE ( SELECT id FROM required ) IN (1)
  [1m[36m (0.4ms)[0m  [1mDROP VIEW hello_world[0m
SQLite3::SQLException: no such view: hello_world: DROP VIEW hello_world
  [1m[35m (0.1ms)[0m  DROP VIEW required
SQLite3::SQLException: no such view: required: DROP VIEW required
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  SELECT 1 as id
  [1m[36m (0.1ms)[0m  [1mSELECT 'HelloWorld' WHERE ( SELECT id FROM required ) IN (1)[0m
SQLite3::SQLException: no such table: required: SELECT 'HelloWorld' WHERE ( SELECT id FROM required ) IN (1)
  [1m[36m (0.3ms)[0m  [1mDROP VIEW required[0m
SQLite3::SQLException: no such view: required: DROP VIEW required
  [1m[35m (0.2ms)[0m  DROP VIEW hello_world
SQLite3::SQLException: no such view: hello_world: DROP VIEW hello_world
  [1m[36m (0.1ms)[0m  [1mDROP VIEW required[0m
SQLite3::SQLException: no such view: required: DROP VIEW required
  [1m[35mActiveRecord::SchemaMigration Load (0.1ms)[0m  SELECT "schema_migrations".* FROM "schema_migrations"
  [1m[36m (0.1ms)[0m  [1mSELECT 1 as id[0m
  [1m[35m (0.1ms)[0m  SELECT 'HelloWorld' WHERE ( SELECT id FROM required ) IN (1)
SQLite3::SQLException: no such table: required: SELECT 'HelloWorld' WHERE ( SELECT id FROM required ) IN (1)
  [1m[36m (0.3ms)[0m  [1mDROP VIEW required[0m
SQLite3::SQLException: no such view: required: DROP VIEW required
  [1m[35m (0.1ms)[0m  DROP VIEW hello_world
SQLite3::SQLException: no such view: hello_world: DROP VIEW hello_world
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  SELECT 1 as id
  [1m[36m (0.1ms)[0m  [1mSELECT 'HelloWorld' WHERE ( SELECT id FROM required ) IN (1)[0m
SQLite3::SQLException: no such table: required: SELECT 'HelloWorld' WHERE ( SELECT id FROM required ) IN (1)
  [1m[36m (0.1ms)[0m  [1mDROP VIEW DROP VIEW required[0m
SQLite3::SQLException: near "DROP": syntax error: DROP VIEW DROP VIEW required
  [1m[35m (0.1ms)[0m  DROP VIEW DROP VIEW hello_world
SQLite3::SQLException: near "DROP": syntax error: DROP VIEW DROP VIEW hello_world
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (1.1ms)[0m  CREATE VIEW required AS SELECT 1 as id
  [1m[36m (1.1ms)[0m  [1mCREATE VIEW hello_world AS SELECT 'HelloWorld' WHERE ( SELECT id FROM required ) IN (1)[0m
  [1m[36m (0.1ms)[0m  [1mDROP VIEW DROP VIEW required[0m
SQLite3::SQLException: near "DROP": syntax error: DROP VIEW DROP VIEW required
  [1m[35m (0.1ms)[0m  DROP VIEW DROP VIEW hello_world
SQLite3::SQLException: near "DROP": syntax error: DROP VIEW DROP VIEW hello_world
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  CREATE VIEW required AS SELECT 1 as id
SQLite3::SQLException: table required already exists: CREATE VIEW required AS SELECT 1 as id
  [1m[36m (2.2ms)[0m  [1mDROP VIEW required[0m
  [1m[35m (0.9ms)[0m  DROP VIEW hello_world
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (1.0ms)[0m  CREATE VIEW required AS SELECT 1 as id
  [1m[36m (0.9ms)[0m  [1mCREATE VIEW hello_world AS SELECT 'HelloWorld' WHERE ( SELECT id FROM required ) IN (1)[0m
  [1m[36m (2.1ms)[0m  [1mDROP VIEW required[0m
  [1m[35m (1.1ms)[0m  DROP VIEW hello_world
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (1.1ms)[0m  CREATE VIEW required AS SELECT 1 as id
  [1m[36m (0.9ms)[0m  [1mCREATE VIEW hello_world AS SELECT 'HelloWorld' WHERE ( SELECT id FROM required ) IN (1)[0m
  [1m[36m (1.8ms)[0m  [1mDROP VIEW required[0m
  [1m[35m (0.8ms)[0m  DROP VIEW hello_world
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.8ms)[0m  CREATE VIEW required AS SELECT 1 as id
  [1m[36m (0.9ms)[0m  [1mCREATE VIEW hello_world AS SELECT 'HelloWorld' WHERE ( SELECT id FROM required ) IN (1)[0m
  [1m[36m (1.8ms)[0m  [1mDROP VIEW required[0m
  [1m[35m (0.9ms)[0m  DROP VIEW hello_world
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.8ms)[0m  CREATE VIEW required AS SELECT 1 as id
  [1m[36m (0.8ms)[0m  [1mCREATE VIEW hello_world AS SELECT 'HelloWorld' WHERE ( SELECT id FROM required ) IN (1)[0m
  [1m[36m (1.6ms)[0m  [1mDROP VIEW required[0m
  [1m[35m (1.0ms)[0m  DROP VIEW hello_world
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.9ms)[0m  CREATE VIEW required AS SELECT 1 as id
  [1m[36m (1.1ms)[0m  [1mCREATE VIEW hello_world AS SELECT 'HelloWorld' WHERE ( SELECT id FROM required ) IN (1)[0m
  [1m[36m (0.2ms)[0m  [1mCREATE OR REPLACE FUNCTION (x integer, y integer) RETURNS integer AS $$
  BEGIN
    RETURN x + y;
  END;
$$ LANGUAGE plpgsql; add.sql[0m
SQLite3::SQLException: near "OR": syntax error: CREATE OR REPLACE FUNCTION (x integer, y integer) RETURNS integer AS $$
  BEGIN
    RETURN x + y;
  END;
$$ LANGUAGE plpgsql; add.sql
  [1m[36m (0.2ms)[0m  [1mDROP FUNCTION add.sql[0m
SQLite3::SQLException: near "FUNCTION": syntax error: DROP FUNCTION add.sql
  [1m[36m (0.1ms)[0m  [1mDROP FUNCTION add.sql[0m
SQLite3::SQLException: near "FUNCTION": syntax error: DROP FUNCTION add.sql
  [1m[36m (0.2ms)[0m  [1mDROP FUNCTION add.sql[0m
SQLite3::SQLException: near "FUNCTION": syntax error: DROP FUNCTION add.sql
  [1m[36m (0.1ms)[0m  [1mDROP FUNCTION add.sql[0m
SQLite3::SQLException: near "FUNCTION": syntax error: DROP FUNCTION add.sql
  [1m[36m (0.2ms)[0m  [1mDROP FUNCTION add.sql[0m
SQLite3::SQLException: near "FUNCTION": syntax error: DROP FUNCTION add.sql
  [1m[36m (0.2ms)[0m  [1mDROP FUNCTION add.sql[0m
SQLite3::SQLException: near "FUNCTION": syntax error: DROP FUNCTION add.sql
  [1m[36m (0.2ms)[0m  [1mDROP FUNCTION add.sql[0m
SQLite3::SQLException: near "FUNCTION": syntax error: DROP FUNCTION add.sql
  [1m[36m (0.2ms)[0m  [1mDROP FUNCTION add.sql[0m
SQLite3::SQLException: near "FUNCTION": syntax error: DROP FUNCTION add.sql
  [1m[36m (0.2ms)[0m  [1mDROP FUNCTION add.sql[0m
SQLite3::SQLException: near "FUNCTION": syntax error: DROP FUNCTION add.sql
  [1m[36m (0.2ms)[0m  [1mDROP FUNCTION add.sql[0m
SQLite3::SQLException: near "FUNCTION": syntax error: DROP FUNCTION add.sql
  [1m[36m (0.1ms)[0m  [1mDROP FUNCTION add.sql[0m
SQLite3::SQLException: near "FUNCTION": syntax error: DROP FUNCTION add.sql
  [1m[36m (0.2ms)[0m  [1mDROP FUNCTION add.sql[0m
SQLite3::SQLException: near "FUNCTION": syntax error: DROP FUNCTION add.sql
  [1m[36m (0.2ms)[0m  [1mDROP FUNCTION add[0m
SQLite3::SQLException: near "FUNCTION": syntax error: DROP FUNCTION add
  [1m[35m (0.2ms)[0m  CREATE VIEW required
SQLite3::SQLException: near "required": syntax error: CREATE VIEW required
  [1m[36m (0.1ms)[0m  [1mCREATE VIEW hello_world[0m
SQLite3::SQLException: near "hello_world": syntax error: CREATE VIEW hello_world
  [1m[35m (1.0ms)[0m  CREATE TABLE "schema_migrations" ("version" varchar NOT NULL) 
  [1m[36m (0.1ms)[0m  [1mselect sqlite_version(*)[0m
  [1m[35m (0.8ms)[0m  CREATE UNIQUE INDEX "unique_schema_migrations" ON "schema_migrations" ("version")
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  CREATE VIEW SELECT 1 as id
SQLite3::SQLException: near "SELECT": syntax error: CREATE VIEW SELECT 1 as id
  [1m[36m (0.2ms)[0m  [1mDROP FUNCTION add[0m
SQLite3::SQLException: near "FUNCTION": syntax error: DROP FUNCTION add
  [1m[35m (0.2ms)[0m  CREATE VIEW required
SQLite3::SQLException: near "required": syntax error: CREATE VIEW required
  [1m[36m (0.2ms)[0m  [1mCREATE VIEW hello_world[0m
SQLite3::SQLException: near "hello_world": syntax error: CREATE VIEW hello_world
  [1m[35m (1.2ms)[0m  CREATE TABLE "schema_migrations" ("version" varchar NOT NULL) 
  [1m[36m (0.1ms)[0m  [1mselect sqlite_version(*)[0m
  [1m[35m (0.9ms)[0m  CREATE UNIQUE INDEX "unique_schema_migrations" ON "schema_migrations" ("version")
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.1ms)[0m  CREATE VIEW SELECT 1 as id
SQLite3::SQLException: near "SELECT": syntax error: CREATE VIEW SELECT 1 as id
  [1m[36m (0.2ms)[0m  [1mDROP FUNCTION add[0m
SQLite3::SQLException: near "FUNCTION": syntax error: DROP FUNCTION add
  [1m[35m (0.1ms)[0m  CREATE VIEW required
SQLite3::SQLException: near "required": syntax error: CREATE VIEW required
  [1m[36m (0.1ms)[0m  [1mCREATE VIEW hello_world[0m
SQLite3::SQLException: near "hello_world": syntax error: CREATE VIEW hello_world
  [1m[35m (1.9ms)[0m  CREATE TABLE "schema_migrations" ("version" varchar NOT NULL) 
  [1m[36m (0.1ms)[0m  [1mselect sqlite_version(*)[0m
  [1m[35m (1.2ms)[0m  CREATE UNIQUE INDEX "unique_schema_migrations" ON "schema_migrations" ("version")
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (1.0ms)[0m  CREATE VIEW required AS SELECT 1 as id
  [1m[36m (0.2ms)[0m  [1mDROP FUNCTION add[0m
SQLite3::SQLException: near "FUNCTION": syntax error: DROP FUNCTION add
  [1m[35m (0.1ms)[0m  CREATE VIEW required
SQLite3::SQLException: near "required": syntax error: CREATE VIEW required
  [1m[36m (0.1ms)[0m  [1mCREATE VIEW hello_world[0m
SQLite3::SQLException: near "hello_world": syntax error: CREATE VIEW hello_world
  [1m[35m (1.4ms)[0m  CREATE TABLE "schema_migrations" ("version" varchar NOT NULL) 
  [1m[36m (0.1ms)[0m  [1mselect sqlite_version(*)[0m
  [1m[35m (0.8ms)[0m  CREATE UNIQUE INDEX "unique_schema_migrations" ON "schema_migrations" ("version")
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.7ms)[0m  CREATE VIEW required AS SELECT 1 as id
  [1m[36m (0.9ms)[0m  [1mCREATE VIEW hello_world AS  --!require required
SELECT 'HelloWorld' WHERE ( SELECT id FROM required ) IN (1)[0m
  [1m[36m (0.2ms)[0m  [1mDROP FUNCTION add[0m
SQLite3::SQLException: near "FUNCTION": syntax error: DROP FUNCTION add
  [1m[35m (0.1ms)[0m  CREATE VIEW required
SQLite3::SQLException: near "required": syntax error: CREATE VIEW required
  [1m[36m (0.1ms)[0m  [1mCREATE VIEW hello_world[0m
SQLite3::SQLException: near "hello_world": syntax error: CREATE VIEW hello_world
  [1m[35m (1.4ms)[0m  CREATE TABLE "schema_migrations" ("version" varchar NOT NULL) 
  [1m[36m (0.1ms)[0m  [1mselect sqlite_version(*)[0m
  [1m[35m (0.9ms)[0m  CREATE UNIQUE INDEX "unique_schema_migrations" ON "schema_migrations" ("version")
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.8ms)[0m  CREATE VIEW required AS SELECT 1 as id
  [1m[36m (0.9ms)[0m  [1mCREATE VIEW hello_world AS  --!require required
SELECT 'HelloWorld' WHERE ( SELECT id FROM required ) IN (1)[0m
  [1m[36m (0.2ms)[0m  [1mDROP FUNCTION add[0m
SQLite3::SQLException: near "FUNCTION": syntax error: DROP FUNCTION add
  [1m[35m (0.1ms)[0m  CREATE VIEW required
SQLite3::SQLException: near "required": syntax error: CREATE VIEW required
  [1m[36m (0.1ms)[0m  [1mCREATE VIEW hello_world[0m
SQLite3::SQLException: near "hello_world": syntax error: CREATE VIEW hello_world
  [1m[35m (1.0ms)[0m  CREATE TABLE "schema_migrations" ("version" varchar NOT NULL) 
  [1m[36m (0.1ms)[0m  [1mselect sqlite_version(*)[0m
  [1m[35m (1.0ms)[0m  CREATE UNIQUE INDEX "unique_schema_migrations" ON "schema_migrations" ("version")
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.9ms)[0m  CREATE VIEW required AS SELECT 1 as id
  [1m[36m (0.8ms)[0m  [1mCREATE VIEW hello_world AS  --!require required
SELECT 'HelloWorld' WHERE ( SELECT id FROM required ) IN (1)[0m
  [1m[36m (0.2ms)[0m  [1mDROP FUNCTION add[0m
SQLite3::SQLException: near "FUNCTION": syntax error: DROP FUNCTION add
  [1m[35m (0.1ms)[0m  CREATE VIEW required
SQLite3::SQLException: near "required": syntax error: CREATE VIEW required
  [1m[36m (0.1ms)[0m  [1mCREATE VIEW hello_world[0m
SQLite3::SQLException: near "hello_world": syntax error: CREATE VIEW hello_world
  [1m[35m (1.2ms)[0m  CREATE TABLE "schema_migrations" ("version" varchar NOT NULL) 
  [1m[36m (0.1ms)[0m  [1mselect sqlite_version(*)[0m
  [1m[35m (0.9ms)[0m  CREATE UNIQUE INDEX "unique_schema_migrations" ON "schema_migrations" ("version")
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.8ms)[0m  CREATE VIEW required AS SELECT 1 as id
  [1m[36m (1.1ms)[0m  [1mCREATE VIEW hello_world AS  --!require required
SELECT 'HelloWorld' WHERE ( SELECT id FROM required ) IN (1)[0m
  [1m[36m (0.2ms)[0m  [1mCREATE VIEW required[0m
SQLite3::SQLException: near "required": syntax error: CREATE VIEW required
  [1m[35m (0.1ms)[0m  CREATE VIEW hello_world
SQLite3::SQLException: near "hello_world": syntax error: CREATE VIEW hello_world
  [1m[36m (1.1ms)[0m  [1mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL) [0m
  [1m[35m (0.1ms)[0m  select sqlite_version(*)
  [1m[36m (0.9ms)[0m  [1mCREATE UNIQUE INDEX "unique_schema_migrations" ON "schema_migrations" ("version")[0m
  [1m[35mActiveRecord::SchemaMigration Load (0.1ms)[0m  SELECT "schema_migrations".* FROM "schema_migrations"
  [1m[36m (3.9ms)[0m  [1mCREATE VIEW required AS SELECT 1 as id[0m
  [1m[35m (0.9ms)[0m  CREATE VIEW hello_world AS  --!require required
SELECT 'HelloWorld' WHERE ( SELECT id FROM required ) IN (1)
  [1m[36m (0.2ms)[0m  [1mDROP FUNCTION add[0m
SQLite3::SQLException: near "FUNCTION": syntax error: DROP FUNCTION add
  [1m[36m (0.2ms)[0m  [1mCREATE VIEW required[0m
SQLite3::SQLException: near "required": syntax error: CREATE VIEW required
  [1m[36m (0.4ms)[0m  [1mDROP VIEW required[0m
SQLite3::SQLException: no such view: required: DROP VIEW required
  [1m[36m (0.3ms)[0m  [1mDROP VIEW required[0m
SQLite3::SQLException: no such view: required: DROP VIEW required
  [1m[36m (0.3ms)[0m  [1mDROP VIEW required[0m
SQLite3::SQLException: no such view: required: DROP VIEW required
  [1m[36m (0.3ms)[0m  [1mDROP VIEW required[0m
SQLite3::SQLException: no such view: required: DROP VIEW required
  [1m[35m (0.1ms)[0m  DROP VIEW hello_world
SQLite3::SQLException: no such view: hello_world: DROP VIEW hello_world
  [1m[36m (1.2ms)[0m  [1mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL) [0m
  [1m[35m (0.1ms)[0m  select sqlite_version(*)
  [1m[36m (0.8ms)[0m  [1mCREATE UNIQUE INDEX "unique_schema_migrations" ON "schema_migrations" ("version")[0m
  [1m[35mActiveRecord::SchemaMigration Load (0.1ms)[0m  SELECT "schema_migrations".* FROM "schema_migrations"
  [1m[36m (0.7ms)[0m  [1mCREATE VIEW required AS SELECT 1 as id[0m
  [1m[35m (0.7ms)[0m  CREATE VIEW hello_world AS  --!require required
SELECT 'HelloWorld' WHERE ( SELECT id FROM required ) IN (1)
  [1m[36m (0.3ms)[0m  [1mDROP VIEW required[0m
SQLite3::SQLException: no such view: required: DROP VIEW required
  [1m[35m (0.2ms)[0m  DROP VIEW hello_world
SQLite3::SQLException: no such view: hello_world: DROP VIEW hello_world
  [1m[36m (1.0ms)[0m  [1mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL) [0m
  [1m[35m (0.1ms)[0m  select sqlite_version(*)
  [1m[36m (0.8ms)[0m  [1mCREATE UNIQUE INDEX "unique_schema_migrations" ON "schema_migrations" ("version")[0m
  [1m[35mActiveRecord::SchemaMigration Load (0.1ms)[0m  SELECT "schema_migrations".* FROM "schema_migrations"
  [1m[36m (4.8ms)[0m  [1mCREATE VIEW required AS SELECT 1 as id[0m
  [1m[35m (1.3ms)[0m  CREATE VIEW hello_world AS  --!require required
SELECT 'HelloWorld' WHERE ( SELECT id FROM required ) IN (1)
  [1m[36m (0.9ms)[0m  [1mCREATE OR REPLACE FUNCTION (x integer, y integer) RETURNS integer AS $$
  BEGIN
    RETURN x + y;
  END;
$$ LANGUAGE plpgsql; add[0m
PG::SyntaxError: ERROR:  syntax error at or near "("
LINE 1: CREATE OR REPLACE FUNCTION (x integer, y integer) RETURNS in...
                                   ^
: CREATE OR REPLACE FUNCTION (x integer, y integer) RETURNS integer AS $$
  BEGIN
    RETURN x + y;
  END;
$$ LANGUAGE plpgsql; add
  [1m[36m (0.3ms)[0m  [1mCREATE OR REPLACE FUNCTION add (x integer, y integer) RETURNS integer AS $$
  BEGIN
    RETURN x + y;
  END;
$$ LANGUAGE plpgsql; add[0m
PG::SyntaxError: ERROR:  syntax error at or near "add"
LINE 5: $$ LANGUAGE plpgsql; add
                             ^
: CREATE OR REPLACE FUNCTION add (x integer, y integer) RETURNS integer AS $$
  BEGIN
    RETURN x + y;
  END;
$$ LANGUAGE plpgsql; add
  [1m[36m (8.7ms)[0m  [1mCREATE OR REPLACE FUNCTION add (x integer, y integer) RETURNS integer AS $$
  BEGIN
    RETURN x + y;
  END;
$$ LANGUAGE plpgsql;[0m
  [1m[35m (17.7ms)[0m  DROP VIEW required
PG::UndefinedTable: ERROR:  view "required" does not exist
: DROP VIEW required
  [1m[36m (0.3ms)[0m  [1mDROP VIEW hello_world[0m
PG::UndefinedTable: ERROR:  view "hello_world" does not exist
: DROP VIEW hello_world
  [1m[35m (24.1ms)[0m  CREATE TABLE "schema_migrations" ("version" character varying NOT NULL) 
  [1m[36m (1.0ms)[0m  [1mCREATE UNIQUE INDEX  "unique_schema_migrations" ON "schema_migrations"  ("version")[0m
  [1m[35mActiveRecord::SchemaMigration Load (0.3ms)[0m  SELECT "schema_migrations".* FROM "schema_migrations"
  [1m[36m (23.3ms)[0m  [1mCREATE VIEW required AS SELECT 1 as id[0m
  [1m[35m (5.5ms)[0m  CREATE VIEW hello_world AS  --!require required
SELECT 'HelloWorld' WHERE ( SELECT id FROM required ) IN (1)
  [1m[36m (12.3ms)[0m  [1mCREATE OR REPLACE FUNCTION add (x integer, y integer) RETURNS integer AS $$
  BEGIN
    RETURN x + y;
  END;
$$ LANGUAGE plpgsql;[0m
  [1m[35m (10.6ms)[0m  DROP VIEW required
PG::DependentObjectsStillExist: ERROR:  cannot drop view required because other objects depend on it
DETAIL:  view hello_world depends on view required
HINT:  Use DROP ... CASCADE to drop the dependent objects too.
: DROP VIEW required
  [1m[36m (18.0ms)[0m  [1mDROP VIEW hello_world[0m
  [1m[35mActiveRecord::SchemaMigration Load (0.2ms)[0m  SELECT "schema_migrations".* FROM "schema_migrations"
  [1m[36m (0.2ms)[0m  [1mCREATE VIEW required AS SELECT 1 as id[0m
PG::DuplicateTable: ERROR:  relation "required" already exists
: CREATE VIEW required AS SELECT 1 as id
  [1m[36m (2.5ms)[0m  [1mCREATE OR REPLACE FUNCTION add (x integer, y integer) RETURNS integer AS $$
  BEGIN
    RETURN x + y;
  END;
$$ LANGUAGE plpgsql;[0m
  [1m[35m (1.0ms)[0m  DROP VIEW required
  [1m[36m (0.4ms)[0m  [1mDROP VIEW hello_world[0m
PG::UndefinedTable: ERROR:  view "hello_world" does not exist
: DROP VIEW hello_world
  [1m[35mActiveRecord::SchemaMigration Load (0.4ms)[0m  SELECT "schema_migrations".* FROM "schema_migrations"
  [1m[36m (8.1ms)[0m  [1mCREATE VIEW required AS SELECT 1 as id[0m
  [1m[35m (6.6ms)[0m  CREATE VIEW hello_world AS  --!require required
SELECT 'HelloWorld' WHERE ( SELECT id FROM required ) IN (1)
  [1m[36m (2.0ms)[0m  [1mCREATE OR REPLACE FUNCTION add (x integer, y integer) RETURNS integer AS $$
  BEGIN
    RETURN x + y;
  END;
$$ LANGUAGE plpgsql;[0m
  [1m[35m (0.6ms)[0m  DROP VIEW required
PG::DependentObjectsStillExist: ERROR:  cannot drop view required because other objects depend on it
DETAIL:  view hello_world depends on view required
HINT:  Use DROP ... CASCADE to drop the dependent objects too.
: DROP VIEW required
  [1m[36m (0.9ms)[0m  [1mDROP VIEW hello_world[0m
  [1m[35mActiveRecord::SchemaMigration Load (0.5ms)[0m  SELECT "schema_migrations".* FROM "schema_migrations"
  [1m[36m (0.3ms)[0m  [1mCREATE VIEW required AS SELECT 1 as id[0m
PG::DuplicateTable: ERROR:  relation "required" already exists
: CREATE VIEW required AS SELECT 1 as id
  [1m[36m (2.1ms)[0m  [1mCREATE OR REPLACE FUNCTION add (x integer, y integer) RETURNS integer AS $$
  BEGIN
    RETURN x + y;
  END;
$$ LANGUAGE plpgsql;[0m
  [1m[35m (0.9ms)[0m  DROP VIEW required
  [1m[36m (0.3ms)[0m  [1mDROP VIEW hello_world[0m
PG::UndefinedTable: ERROR:  view "hello_world" does not exist
: DROP VIEW hello_world
  [1m[36m (2.0ms)[0m  [1mCREATE OR REPLACE FUNCTION add (x integer, y integer) RETURNS integer AS $$
  BEGIN
    RETURN x + y;
  END;
$$ LANGUAGE plpgsql;[0m
  [1m[35m (0.3ms)[0m  DROP VIEW required
PG::UndefinedTable: ERROR:  view "required" does not exist
: DROP VIEW required
  [1m[36m (2.1ms)[0m  [1mCREATE OR REPLACE FUNCTION add (x integer, y integer) RETURNS integer AS $$
  BEGIN
    RETURN x + y;
  END;
$$ LANGUAGE plpgsql;[0m
  [1m[35m (0.3ms)[0m  DROP VIEW required
PG::UndefinedTable: ERROR:  view "required" does not exist
: DROP VIEW required
  [1m[36m (2.0ms)[0m  [1mCREATE OR REPLACE FUNCTION add (x integer, y integer) RETURNS integer AS $$
  BEGIN
    RETURN x + y;
  END;
$$ LANGUAGE plpgsql;[0m
  [1m[35m (0.3ms)[0m  DROP VIEW required
PG::UndefinedTable: ERROR:  view "required" does not exist
: DROP VIEW required
  [1m[36m (0.2ms)[0m  [1mDROP VIEW hello_world[0m
PG::UndefinedTable: ERROR:  view "hello_world" does not exist
: DROP VIEW hello_world
  [1m[35mActiveRecord::SchemaMigration Load (0.3ms)[0m  SELECT "schema_migrations".* FROM "schema_migrations"
  [1m[36m (6.7ms)[0m  [1mCREATE VIEW required AS SELECT 1 as id[0m
  [1m[35m (6.6ms)[0m  CREATE VIEW hello_world AS --!require required
SELECT 'HelloWorld' WHERE ( SELECT id FROM required ) IN (1)
  [1m[36m (2.3ms)[0m  [1mCREATE OR REPLACE FUNCTION add (x integer, y integer) RETURNS integer AS $$
  BEGIN
    RETURN x + y;
  END;
$$ LANGUAGE plpgsql;[0m
  [1m[35m (0.7ms)[0m  DROP VIEW required
PG::DependentObjectsStillExist: ERROR:  cannot drop view required because other objects depend on it
DETAIL:  view hello_world depends on view required
HINT:  Use DROP ... CASCADE to drop the dependent objects too.
: DROP VIEW required
  [1m[36m (3.0ms)[0m  [1mCREATE OR REPLACE FUNCTION add (x integer, y integer) RETURNS integer AS $$
  BEGIN
    RETURN x + y;
  END;
$$ LANGUAGE plpgsql;[0m
  [1m[36m (1.4ms)[0m  [1mCREATE OR REPLACE FUNCTION add (x integer, y integer) RETURNS integer AS $$
  BEGIN
    RETURN x + y;
  END;
$$ LANGUAGE plpgsql;[0m
  [1m[35m (1.2ms)[0m  DROP VIEW hello_world
  [1m[36m (0.6ms)[0m  [1mDROP VIEW required[0m
  [1m[35mActiveRecord::SchemaMigration Load (0.3ms)[0m  SELECT "schema_migrations".* FROM "schema_migrations"
  [1m[36m (12.4ms)[0m  [1mCREATE VIEW required AS SELECT 1 as id[0m
  [1m[35m (12.6ms)[0m  CREATE VIEW hello_world AS --!require required
SELECT 'HelloWorld' WHERE ( SELECT id FROM required ) IN (1)
  [1m[36m (2.3ms)[0m  [1mCREATE OR REPLACE FUNCTION add (x integer, y integer) RETURNS integer AS $$
  BEGIN
    RETURN x + y;
  END;
$$ LANGUAGE plpgsql;[0m
  [1m[35m (7.2ms)[0m  DROP VIEW hello_world
  [1m[36m (6.7ms)[0m  [1mDROP VIEW required[0m
  [1m[35mActiveRecord::SchemaMigration Load (0.7ms)[0m  SELECT "schema_migrations".* FROM "schema_migrations"
  [1m[36m (13.2ms)[0m  [1mCREATE VIEW required AS SELECT 1 as id[0m
  [1m[35m (7.1ms)[0m  CREATE VIEW hello_world AS --!require required
SELECT 'HelloWorld' WHERE ( SELECT id FROM required ) IN (1)
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[36m (2.0ms)[0m  [1mCREATE OR REPLACE FUNCTION add (x integer, y integer) RETURNS integer AS $$
  BEGIN
    RETURN x + y;
  END;
$$ LANGUAGE plpgsql;[0m
  [1m[35m (6.1ms)[0m  CREATE OR REPLACE FUNCTION tuple_sort (x int[]) RETURNS int[] AS $$
  BEGIN
    IF x[0] > x[1] THEN
      RETURN ARRAY[x[1], x[0]];
    ELSE
      RETURN x;
    END IF;
  END;
$$ LANGUAGE plpgsql;
  [1m[36m (0.4ms)[0m  [1mDROP VIEW chats[0m
PG::UndefinedTable: ERROR:  view "chats" does not exist
: DROP VIEW chats
  [1m[35m (0.2ms)[0m  DROP VIEW messages
PG::UndefinedTable: ERROR:  view "messages" does not exist
: DROP VIEW messages
  [1m[36m (7.3ms)[0m  [1mCREATE TABLE "schema_migrations" ("version" character varying NOT NULL) [0m
  [1m[35m (0.9ms)[0m  CREATE UNIQUE INDEX  "unique_schema_migrations" ON "schema_migrations"  ("version")
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1mSELECT "schema_migrations".* FROM "schema_migrations"[0m
Migrating to CreateTestTables (20160208084226)
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (3.7ms)[0m  [1mCREATE TABLE "users" ("id" serial primary key, "name" character varying, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (0.8ms)[0m  CREATE  INDEX  "index_users_on_name" ON "users"  ("name")
  [1m[36m (2.4ms)[0m  [1mCREATE TABLE "user_messages" ("id" serial primary key, "from_id" integer, "to_id" integer, "content" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (0.7ms)[0m  CREATE  INDEX  "index_user_messages_on_from_id" ON "user_messages"  ("from_id")
  [1m[36m (0.8ms)[0m  [1mCREATE  INDEX  "index_user_messages_on_to_id" ON "user_messages"  ("to_id")[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "schema_migrations" ("version") VALUES ($1)  [["version", "20160208084226"]]
  [1m[36m (0.5ms)[0m  [1mCOMMIT[0m
  [1m[35mActiveRecord::SchemaMigration Load (0.1ms)[0m  SELECT "schema_migrations".* FROM "schema_migrations"
  [1m[36m (1.8ms)[0m  [1mSELECT t2.oid::regclass::text AS to_table, a1.attname AS column, a2.attname AS primary_key, c.conname AS name, c.confupdtype AS on_update, c.confdeltype AS on_delete
FROM pg_constraint c
JOIN pg_class t1 ON c.conrelid = t1.oid
JOIN pg_class t2 ON c.confrelid = t2.oid
JOIN pg_attribute a1 ON a1.attnum = c.conkey[1] AND a1.attrelid = t1.oid
JOIN pg_attribute a2 ON a2.attnum = c.confkey[1] AND a2.attrelid = t2.oid
JOIN pg_namespace t3 ON c.connamespace = t3.oid
WHERE c.contype = 'f'
  AND t1.relname = 'user_messages'
  AND t3.nspname = ANY (current_schemas(false))
ORDER BY c.conname
[0m
  [1m[35m (1.5ms)[0m  SELECT t2.oid::regclass::text AS to_table, a1.attname AS column, a2.attname AS primary_key, c.conname AS name, c.confupdtype AS on_update, c.confdeltype AS on_delete
FROM pg_constraint c
JOIN pg_class t1 ON c.conrelid = t1.oid
JOIN pg_class t2 ON c.confrelid = t2.oid
JOIN pg_attribute a1 ON a1.attnum = c.conkey[1] AND a1.attrelid = t1.oid
JOIN pg_attribute a2 ON a2.attnum = c.confkey[1] AND a2.attrelid = t2.oid
JOIN pg_namespace t3 ON c.connamespace = t3.oid
WHERE c.contype = 'f'
  AND t1.relname = 'users'
  AND t3.nspname = ANY (current_schemas(false))
ORDER BY c.conname

  [1m[36m (10.5ms)[0m  [1mCREATE VIEW messages AS SELECT DISTINCT _.receiver_name, _.receiver_id, _.sender_name, _.sender_id, _.content, _.updated_at, _.created_at
FROM
  (SELECT u2.name as receiver_name, u2.id as receiver_id,
      u1.name as sender_name, u1.id as sender_id,
      um.content as content, um.updated_at as updated_at, um.created_at as created_at
    FROM users u1
    INNER JOIN user_messages um ON ( u1.id = um.from_id )
    INNER JOIN users u2 ON (u2.id = um.to_id)
  UNION
    SELECT u1.name as receiver_name, u1.id as receiver_id,
      u2.name as sender_name, u2.id as sender_id,
      um.content as content, um.updated_at as updated_at, um.created_at as created_at
    FROM users u1
    INNER JOIN user_messages um ON ( u1.id = um.to_id )
    INNER JOIN users u2 ON ( u2.id = um.from_id )
  ORDER BY created_at ASC
) AS _[0m
  [1m[35m (7.1ms)[0m  CREATE VIEW chats AS SELECT tuple_sort(ARRAY[sender_id, receiver_id]) AS ids,
  MIN(created_at) as created_at, MAX(updated_at) as updated_at, COUNT(*) as number_of_messages
FROM messages
GROUP BY tuple_sort(ARRAY[sender_id, receiver_id])
  [1m[36m (1.5ms)[0m  [1mCREATE OR REPLACE FUNCTION add (x integer, y integer) RETURNS integer AS $$
  BEGIN
    RETURN x + y;
  END;
$$ LANGUAGE plpgsql;[0m
  [1m[35m (0.7ms)[0m  CREATE OR REPLACE FUNCTION tuple_sort (x int[]) RETURNS int[] AS $$
  BEGIN
    IF x[0] > x[1] THEN
      RETURN ARRAY[x[1], x[0]];
    ELSE
      RETURN x;
    END IF;
  END;
$$ LANGUAGE plpgsql;
  [1m[36m (1.6ms)[0m  [1mDROP VIEW chats[0m
  [1m[35m (0.8ms)[0m  DROP VIEW messages
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35mActiveRecord::SchemaMigration Load (0.1ms)[0m  SELECT "schema_migrations".* FROM "schema_migrations"
  [1m[36m (1.9ms)[0m  [1mSELECT t2.oid::regclass::text AS to_table, a1.attname AS column, a2.attname AS primary_key, c.conname AS name, c.confupdtype AS on_update, c.confdeltype AS on_delete
FROM pg_constraint c
JOIN pg_class t1 ON c.conrelid = t1.oid
JOIN pg_class t2 ON c.confrelid = t2.oid
JOIN pg_attribute a1 ON a1.attnum = c.conkey[1] AND a1.attrelid = t1.oid
JOIN pg_attribute a2 ON a2.attnum = c.confkey[1] AND a2.attrelid = t2.oid
JOIN pg_namespace t3 ON c.connamespace = t3.oid
WHERE c.contype = 'f'
  AND t1.relname = 'user_messages'
  AND t3.nspname = ANY (current_schemas(false))
ORDER BY c.conname
[0m
  [1m[35m (1.4ms)[0m  SELECT t2.oid::regclass::text AS to_table, a1.attname AS column, a2.attname AS primary_key, c.conname AS name, c.confupdtype AS on_update, c.confdeltype AS on_delete
FROM pg_constraint c
JOIN pg_class t1 ON c.conrelid = t1.oid
JOIN pg_class t2 ON c.confrelid = t2.oid
JOIN pg_attribute a1 ON a1.attnum = c.conkey[1] AND a1.attrelid = t1.oid
JOIN pg_attribute a2 ON a2.attnum = c.confkey[1] AND a2.attrelid = t2.oid
JOIN pg_namespace t3 ON c.connamespace = t3.oid
WHERE c.contype = 'f'
  AND t1.relname = 'users'
  AND t3.nspname = ANY (current_schemas(false))
ORDER BY c.conname

  [1m[36m (8.5ms)[0m  [1mCREATE VIEW messages AS SELECT DISTINCT _.receiver_name, _.receiver_id, _.sender_name, _.sender_id, _.content, _.updated_at, _.created_at
FROM
  (SELECT u2.name as receiver_name, u2.id as receiver_id,
      u1.name as sender_name, u1.id as sender_id,
      um.content as content, um.updated_at as updated_at, um.created_at as created_at
    FROM users u1
    INNER JOIN user_messages um ON ( u1.id = um.from_id )
    INNER JOIN users u2 ON (u2.id = um.to_id)
  UNION
    SELECT u1.name as receiver_name, u1.id as receiver_id,
      u2.name as sender_name, u2.id as sender_id,
      um.content as content, um.updated_at as updated_at, um.created_at as created_at
    FROM users u1
    INNER JOIN user_messages um ON ( u1.id = um.to_id )
    INNER JOIN users u2 ON ( u2.id = um.from_id )
  ORDER BY created_at ASC
) AS _[0m
  [1m[35m (7.6ms)[0m  CREATE VIEW chats AS SELECT tuple_sort(ARRAY[sender_id, receiver_id]) AS ids,
  MIN(created_at) as created_at, MAX(updated_at) as updated_at, COUNT(*) as number_of_messages
FROM messages
GROUP BY tuple_sort(ARRAY[sender_id, receiver_id])
  [1m[36m (0.1ms)[0m  [1mSELECT 1;[0m
  [1m[35m (0.3ms)[0m  SELECT 1;
  [1m[36m (0.3ms)[0m  [1mSELECT 2;[0m
  [1m[35m (0.2ms)[0m  SELECT 2;
  [1m[36m (0.3ms)[0m  [1mSELECT 2[0m
  [1m[35m (8.3ms)[0m  SELECT tuple_sort(ARRAY[1,3])
  [1m[36m (0.9ms)[0m  [1mSELECT tuple_sort(ARRAY[3,1])[0m
  [1m[35m (0.9ms)[0m  SELECT tuple_sort(ARRAY[3,1])
  [1m[36m (2.4ms)[0m  [1mCREATE OR REPLACE FUNCTION add (x integer, y integer) RETURNS integer AS $$
  BEGIN
    RETURN x + y;
  END;
$$ LANGUAGE plpgsql;[0m
  [1m[35m (0.6ms)[0m  CREATE OR REPLACE FUNCTION tuple_sort (x int[]) RETURNS int[] AS $$
  BEGIN
    IF x[0]::int > x[1]::int THEN
      RETURN ARRAY[x[1], x[0]];
    ELSE
      RETURN x;
    END IF;
  END;
$$ LANGUAGE plpgsql;
  [1m[36m (0.3ms)[0m  [1mDROP VIEW chats[0m
PG::UndefinedTable: ERROR:  view "chats" does not exist
: DROP VIEW chats
  [1m[35m (0.2ms)[0m  DROP VIEW messages
PG::UndefinedTable: ERROR:  view "messages" does not exist
: DROP VIEW messages
  [1m[36m (2.3ms)[0m  [1mCREATE TABLE "schema_migrations" ("version" character varying NOT NULL) [0m
  [1m[35m (1.2ms)[0m  CREATE UNIQUE INDEX  "unique_schema_migrations" ON "schema_migrations"  ("version")
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1mSELECT "schema_migrations".* FROM "schema_migrations"[0m
Migrating to CreateTestTables (20160208084226)
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (5.8ms)[0m  [1mCREATE TABLE "users" ("id" serial primary key, "name" character varying, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (0.6ms)[0m  CREATE  INDEX  "index_users_on_name" ON "users"  ("name")
  [1m[36m (2.2ms)[0m  [1mCREATE TABLE "user_messages" ("id" serial primary key, "from_id" integer, "to_id" integer, "content" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (0.6ms)[0m  CREATE  INDEX  "index_user_messages_on_from_id" ON "user_messages"  ("from_id")
  [1m[36m (0.6ms)[0m  [1mCREATE  INDEX  "index_user_messages_on_to_id" ON "user_messages"  ("to_id")[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "schema_migrations" ("version") VALUES ($1)  [["version", "20160208084226"]]
  [1m[36m (0.5ms)[0m  [1mCOMMIT[0m
  [1m[35mActiveRecord::SchemaMigration Load (0.1ms)[0m  SELECT "schema_migrations".* FROM "schema_migrations"
  [1m[36m (2.0ms)[0m  [1mSELECT t2.oid::regclass::text AS to_table, a1.attname AS column, a2.attname AS primary_key, c.conname AS name, c.confupdtype AS on_update, c.confdeltype AS on_delete
FROM pg_constraint c
JOIN pg_class t1 ON c.conrelid = t1.oid
JOIN pg_class t2 ON c.confrelid = t2.oid
JOIN pg_attribute a1 ON a1.attnum = c.conkey[1] AND a1.attrelid = t1.oid
JOIN pg_attribute a2 ON a2.attnum = c.confkey[1] AND a2.attrelid = t2.oid
JOIN pg_namespace t3 ON c.connamespace = t3.oid
WHERE c.contype = 'f'
  AND t1.relname = 'user_messages'
  AND t3.nspname = ANY (current_schemas(false))
ORDER BY c.conname
[0m
  [1m[35m (1.5ms)[0m  SELECT t2.oid::regclass::text AS to_table, a1.attname AS column, a2.attname AS primary_key, c.conname AS name, c.confupdtype AS on_update, c.confdeltype AS on_delete
FROM pg_constraint c
JOIN pg_class t1 ON c.conrelid = t1.oid
JOIN pg_class t2 ON c.confrelid = t2.oid
JOIN pg_attribute a1 ON a1.attnum = c.conkey[1] AND a1.attrelid = t1.oid
JOIN pg_attribute a2 ON a2.attnum = c.confkey[1] AND a2.attrelid = t2.oid
JOIN pg_namespace t3 ON c.connamespace = t3.oid
WHERE c.contype = 'f'
  AND t1.relname = 'users'
  AND t3.nspname = ANY (current_schemas(false))
ORDER BY c.conname

  [1m[36m (7.7ms)[0m  [1mCREATE VIEW messages AS SELECT DISTINCT _.receiver_name, _.receiver_id, _.sender_name, _.sender_id, _.content, _.updated_at, _.created_at
FROM
  (SELECT u2.name as receiver_name, u2.id as receiver_id,
      u1.name as sender_name, u1.id as sender_id,
      um.content as content, um.updated_at as updated_at, um.created_at as created_at
    FROM users u1
    INNER JOIN user_messages um ON ( u1.id = um.from_id )
    INNER JOIN users u2 ON (u2.id = um.to_id)
  UNION
    SELECT u1.name as receiver_name, u1.id as receiver_id,
      u2.name as sender_name, u2.id as sender_id,
      um.content as content, um.updated_at as updated_at, um.created_at as created_at
    FROM users u1
    INNER JOIN user_messages um ON ( u1.id = um.to_id )
    INNER JOIN users u2 ON ( u2.id = um.from_id )
  ORDER BY created_at ASC
) AS _[0m
  [1m[35m (7.7ms)[0m  CREATE VIEW chats AS SELECT tuple_sort(ARRAY[sender_id, receiver_id]) AS ids,
  MIN(created_at) as created_at, MAX(updated_at) as updated_at, COUNT(*) as number_of_messages
FROM messages
GROUP BY tuple_sort(ARRAY[sender_id, receiver_id])
  [1m[36m (1.0ms)[0m  [1mSELECT tuple_sort(ARRAY[3,1])[0m
  [1m[35m (2.1ms)[0m  SELECT tuple_sort(ARRAY[1,3])
